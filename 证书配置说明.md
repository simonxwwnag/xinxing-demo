# 证书文件配置说明

## Docker环境配置

在 `.env` 文件中设置：

```env
CERTIFICATE_DIR=/app/certificates
```

## 为什么是这个路径？

1. **Docker容器工作目录**: `/app`（在Dockerfile中设置）
2. **Volume挂载**: `./certificates:/app/certificates`（在docker-compose.yml中）
3. **容器内路径**: `/app/certificates`

## 完整配置步骤

### 1. 在服务器上编辑.env文件

```bash
cd /root/xinxing_demo/backend
nano .env
```

添加或修改：

```env
# 证书文件目录（Docker容器内路径）
CERTIFICATE_DIR=/app/certificates
```

### 2. 确保证书文件已上传

```bash
# 在服务器上检查
ls -la /root/xinxing_demo/certificates/

# 应该能看到您的证书文件
```

### 3. 重启后端服务

```bash
cd /root/xinxing_demo
docker compose restart backend
```

### 4. 验证配置

```bash
# 进入容器检查
docker compose exec backend bash

# 在容器内
ls -la /app/certificates
python -c "from utils.config import Config; print('证书目录:', Config.CERTIFICATE_DIR)"
```

## 文件映射关系

```
宿主机路径                    Docker容器内路径
/root/xinxing_demo/certificates  →  /app/certificates
```

## 验证证书访问

### 测试API

```bash
# 测试证书匹配
curl -X POST http://124.220.51.21/api/certificate/match \
  -H "Content-Type: application/json" \
  -d '{"names": ["张三"]}'

# 测试证书文件访问（替换为实际文件名）
curl -I http://124.220.51.21/api/certificate/file/证书文件名.pdf
```

### 在前端测试

1. 访问 http://124.220.51.21
2. 进入"证书人员"页面
3. 查询人员，应该能看到匹配的证书文件

## 常见问题

### Q: 如果不设置CERTIFICATE_DIR会怎样？

A: 会使用默认路径，在Docker容器内可能不正确。建议明确设置。

### Q: 证书文件上传到哪里？

A: 上传到服务器的 `/root/xinxing_demo/certificates/` 目录，会自动映射到容器的 `/app/certificates/`

### Q: 如何查看证书文件是否在容器内？

A: 
```bash
docker compose exec backend ls -la /app/certificates
```

